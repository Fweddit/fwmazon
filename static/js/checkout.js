// Generated by CoffeeScript 1.6.3
var $, CostUpdater, Shipping,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

$ = jQuery;

Shipping = (function() {
  function Shipping() {
    this.update_shipping = __bind(this.update_shipping, this);
    this._volume = $('span#js-volume').data('volume');
    this.init_events();
    this.update_shipping();
  }

  Shipping.prototype.init_events = function() {
    return $('body').on('change', 'select#shipping', this.update_shipping);
  };

  Shipping.prototype.update_shipping = function(e) {
    var $option, cost, delay, total_shipping;
    if (e) {
      e.preventDefault();
      $option = $(e.currentTarget).children(':selected');
    } else {
      $option = $('select#shipping').children(':selected');
    }
    cost = parseFloat($option.data('cost'));
    delay = parseFloat($option.data('delay'));
    total_shipping = cost * this._volume;
    $('span#js-shipping-cost').text(total_shipping.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",")).data('cost', total_shipping);
    return $('body').trigger('cost_update');
  };

  return Shipping;

})();

window.show_error = function(message) {
  var id;
  id = Math.floor(Math.random() * 100);
  $('#messages').append("<div class=\"alert alert-danger\" id=\"message-" + id + "\">" + message + "</div>");
  return setTimeout(function() {
    return hide_message(id);
  }, 5000);
};

window.hide_message = function(id) {
  return $("#messages #message-" + id).remove();
};

CostUpdater = (function() {
  function CostUpdater() {
    this.update_price = __bind(this.update_price, this);
    this.fitting = $('span#js-fitting-price').data('price');
    $('body').on('cost_update', this.update_price);
    $('body').on('change', 'input#fitting', this.update_price);
  }

  CostUpdater.prototype.update_price = function() {
    var shipping;
    shipping = $('span#js-shipping-cost').data('cost');
    $('span#js-review-shopping').text(this.to_comma(shipping));
    if ($('input#fitting').prop('checked')) {
      return $('span#js-options-cost').text(this.to_comma(this.fitting));
    } else {
      return $('span#js-options-cost').text('0');
    }
  };

  CostUpdater.prototype.to_comma = function(int) {
    return int.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
  };

  return CostUpdater;

})();

$(document).on('ready', function() {
  window.cost_update = new CostUpdater();
  return window.shipping = new Shipping();
});
